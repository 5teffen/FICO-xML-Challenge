<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Visual Interface</title>
    <meta name="author" content="NYU UGR Team">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,700' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
    <link href="/static/css/scratchstyle.css" rel="stylesheet" type="text/css">
    <!-- D3.js source -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!-- SVG script -->
    <script type="text/javascript" src="/static/js/better_scripts.js"></script>
  </head>

  <body>
    <div class="main">
      <div class="left-sidebar">
        <header class="site-header">
          <h1>FICO CHALLENGE</h1>
        </header>
        <nav class="left-nav">
          <ul>
            <li><a>GLOBAL EXPLANATION</a></li>
            <li><a>LOCAL EXPLANATIONS</a></li>
          </ul>
        </nav>
        <!-- Search box -->
        <div class="input-group">
          <input id="search-bar" type="text" class="form-control" placeholder="ID number" name="srch-term" autocomplete="off"
                 onkeydown="formHandle(event)">
        </div>
        <nav class="id-list">
          <ul>
          </ul>
        </nav>
      </div>
      
      <div class="right-side" id="demo">
        <div class="right-header">
          <div class="id-display">
            ID: 100
          </div>
          <div class="model-display">
            Model Prediction: 61%
          </div>
          <div class="category-display">
            TP
          </div>

        </div>
        <div class="d3-space">
          D3 graphs
        </div>
        <div class="txt-space">
          Text explanation
        </div>
        
      </div>

    </div>

    <script>
    
      var samples = 10459;
      for (i = 1; i <= samples; i++) {
        var para = document.createElement("li");
        para.innerHTML = "ID " + i.toString();
        para.id = "link-" + i.toString();
        para.onclick = function () { makeRequest('list', this); };
        document.getElementsByTagName("ul")[1].append(para);
      }

      function formHandle(event) {
        if (event.which == 13 || event.keyCode == 13){
          makeRequest('form', 0);
          return false;
        }
      }

      var httpRequest;
      function makeRequest(source, sample) {
        httpRequest = new XMLHttpRequest();
        if (!httpRequest) {
          alert('Giving up :( Cannot create an XMLHTTP instance');
          return false;
        }
        if (source == 'form') {
          var s = document.getElementById("search-bar").value;
          document.getElementById("search-bar").value="";
        }
        else if (source == 'list') {
          var s = sample.id.substring(5);
        } 
          httpRequest.onreadystatechange = alertContents;
          httpRequest.open('GET', '/instance?sample='+s);
          httpRequest.send();
          return false;        
      }

      function alertContents() {
        if (httpRequest.readyState === XMLHttpRequest.DONE) {
          if (httpRequest.status === 200) {

            //Do stuff with the response
            // var resp = JSON.parse(httpRequest.responseText);
            var resp_arr = httpRequest.responseText.split('~');
            var testData = [];
            for (i=0; i<22; i++){
              testData.push(JSON.parse(resp_arr[i]));
            }
            var resp = JSON.parse(resp_arr[23]);
            
            var index = resp['sample'].toString();
            var good_percent = resp['good_percent'];
            var correct = parseInt(resp['model_correct']);
            var category = resp['category'];
            var disp_percent = Math.round((good_percent)*100);
            document.getElementsByClassName("id-display")[0].innerHTML = "ID: " + index;
            // document.getElementsByClassName("model-display")[0].innerHTML = disp_percent.toString() + "%";
            document.getElementsByClassName("model-display")[0].innerHTML = "Model prediction: " + disp_percent.toString() + "% ";
            document.getElementsByClassName("category-display")[0].innerHTML = category;
            document.getElementsByClassName("d3-space")[0].innerHTML = "";
            draw_svg(testData);
            
          } else {
            alert('HttpRequest Error')
          }
        }
      }


    
    </script>

  </body>

</html>
